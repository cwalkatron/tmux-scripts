#!/bin/bash

ARGS=$(getopt -o t:h -n "tssh" -- "$@")

usage () {
    cat <<EOF
Usage $(basename $0) [ -n WINDOWNAME ] [ HOST [ HOST ... ] ]

 -n             : name the tmux window WINDOWNAME

Open a new tmux window with a pane for an ssh session to each HOST
EOF
}

eval set -- "$ARGS"

# option processing
while true; do
    case "$1" in
        -t) WNAME=${2}; shift 2;;
        -h) usage; exit 0;;
        --) shift; break;;
        *) echo "Internal error!"; exit 1;;
    esac
done

first=$1; shift
n=$(tmux neww -n ${WNAME} -dP "ssh $first")
nw=$(echo ${n} | cut -d. -f1)
for m in $*; do
    tmux splitw -t $n -v "ssh $m"
done
tmux selectl -t $nw even-vertical
